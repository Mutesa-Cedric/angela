/* ════════════════════════════════════════════════════════════════
   ANGELA — Intelligence Command Center
   Blueprint/Palantir palette • Grid layout • Dense authority
   ════════════════════════════════════════════════════════════════ */

/* ── CSS Variables — based on Palantir Blueprint dark theme ── */
:root {
  --base: #0a0e13;
  --surface: #111418;
  --surface-raised: #1C2127;
  --surface-hover: #252A31;
  --border: rgba(255, 255, 255, 0.06);
  --border-active: rgba(255, 255, 255, 0.12);
  --text-primary: #E0E4E8;
  --text-secondary: #8899AA;
  --text-heading: #F6F7F9;
  --text-disabled: #4A5568;
  --accent: #2D72D2;
  --accent-dim: rgba(45, 114, 210, 0.12);
  --accent-red: #CD4246;
  --accent-amber: #F39F41;
  --accent-green: #238551;
  --accent-purple: #7961DB;
  --scrollbar-size: 6px;
  --scrollbar-track: rgba(0, 0, 0, 0.3);
  --scrollbar-thumb: rgba(255, 255, 255, 0.08);
  --scrollbar-thumb-hover: rgba(255, 255, 255, 0.14);
  --mono: ui-monospace, "SF Mono", "Cascadia Code", "Fira Code", Menlo, monospace;
  --nav-h: 40px;
  --footer-h: 26px;
  --sidebar-w: 260px;
}

/* ── Reset ── */
* { margin: 0; padding: 0; box-sizing: border-box; }

html, body {
  width: 100%;
  height: 100%;
  overflow: hidden;
  background: var(--base);
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
  color: var(--text-primary);
  font-size: 12px;
  line-height: 1.5;
}

/* ── Grid Layout ── */
body {
  display: grid;
  grid-template-rows: var(--nav-h) 1fr var(--footer-h);
  grid-template-columns: var(--sidebar-w) 1fr 0;
  grid-template-areas:
    "nav    nav      nav"
    "side   viewport detail"
    "footer footer   footer";
  transition: grid-template-columns 0.25s ease;
}

body.detail-open {
  grid-template-columns: var(--sidebar-w) 1fr 400px;
}

/* Hide chrome before data is loaded — wizard fills the screen */
body:not(.graph-loaded) #top-nav,
body:not(.graph-loaded) #sidebar,
body:not(.graph-loaded) #status-bar {
  display: none;
}

body:not(.graph-loaded) {
  grid-template-rows: 0 1fr 0;
  grid-template-columns: 0 1fr 0;
}

/* ── Pitch Mode ── */
body.pitch-mode #scene-canvas {
  filter: saturate(1.12) contrast(1.08) brightness(1.04);
}

/* ── Scrollbar ── */
::-webkit-scrollbar { width: var(--scrollbar-size); height: var(--scrollbar-size); }
::-webkit-scrollbar-track { background: var(--scrollbar-track); }
::-webkit-scrollbar-thumb { background: var(--scrollbar-thumb); border-radius: 3px; }
::-webkit-scrollbar-thumb:hover { background: var(--scrollbar-thumb-hover); }

/* ════════════════════════════════════════════════════════════════
   TOP NAVIGATION BAR
   ════════════════════════════════════════════════════════════════ */

#top-nav {
  grid-area: nav;
  display: flex;
  align-items: center;
  gap: 16px;
  padding: 0 16px;
  background: var(--surface);
  border-bottom: 1px solid var(--border);
  z-index: 50;
}

.nav-brand {
  display: flex;
  align-items: center;
  gap: 8px;
  flex-shrink: 0;
}

.brand-mark {
  color: var(--accent);
  font-size: 16px;
}

.brand-name {
  font-family: var(--mono);
  font-size: 14px;
  font-weight: 700;
  letter-spacing: 3px;
  color: var(--accent);
}

.brand-separator {
  color: var(--text-secondary);
  font-size: 14px;
  opacity: 0.4;
}

.brand-context {
  font-family: var(--mono);
  font-size: 10px;
  font-weight: 500;
  letter-spacing: 2px;
  color: var(--text-secondary);
  text-transform: uppercase;
}

/* NLQ Bar in nav */
#nlq-bar {
  flex: 1;
  max-width: 560px;
  margin: 0 auto;
}

#nlq-input-row {
  display: flex;
  align-items: center;
  gap: 4px;
}

#nlq-input {
  flex: 1;
  background: var(--base);
  border: 1px solid var(--border);
  border-radius: 3px;
  padding: 7px 12px;
  font-size: 12px;
  color: var(--text-primary);
  outline: none;
  transition: border-color 0.15s;
  font-family: inherit;
}

#nlq-input:focus {
  border-color: var(--accent);
}

#nlq-input::placeholder {
  color: var(--text-secondary);
}

#nlq-submit,
#agent-submit,
#nlq-clear {
  background: var(--surface-raised);
  border: 1px solid var(--border);
  color: var(--text-primary);
  font-size: 10px;
  font-weight: 600;
  letter-spacing: 1px;
  padding: 7px 12px;
  border-radius: 3px;
  cursor: pointer;
  transition: all 0.15s;
  white-space: nowrap;
}

#nlq-submit:hover,
#agent-submit:hover,
#nlq-clear:hover {
  background: var(--surface-hover);
  border-color: var(--border-active);
  color: var(--text-heading);
}

#agent-submit {
  color: var(--accent-purple);
}

#agent-submit:hover {
  color: var(--accent-purple);
  background: rgba(121, 97, 219, 0.12);
}

#agent-submit.running {
  color: var(--accent-amber);
  border-color: rgba(243, 159, 65, 0.3);
  background: rgba(243, 159, 65, 0.08);
}

/* NLQ loading state */
#nlq-bar.loading #nlq-input {
  border-color: var(--accent);
  box-shadow: 0 0 0 1px rgba(45, 114, 210, 0.15);
}

#nlq-bar.loading::after {
  content: "";
  display: block;
  height: 2px;
  margin-top: 2px;
  background: linear-gradient(90deg, transparent, var(--accent), transparent);
  background-size: 200% 100%;
  animation: nlq-loading-bar 1.2s ease-in-out infinite;
  border-radius: 1px;
}

@keyframes nlq-loading-bar {
  0% { background-position: 200% 0; }
  100% { background-position: -200% 0; }
}

/* ── Query Result Toast ── */
.nlq-toast {
  position: fixed;
  top: calc(var(--nav-h) + 12px);
  left: 50%;
  transform: translateX(-50%) translateY(-20px);
  opacity: 0;
  pointer-events: none;
  z-index: 55;
  display: flex;
  align-items: stretch;
  background: var(--surface-raised);
  border: 1px solid var(--border-active);
  border-radius: 4px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.5), 0 0 0 1px rgba(45, 114, 210, 0.1);
  min-width: 340px;
  max-width: 520px;
  overflow: hidden;
  transition: opacity 0.3s ease, transform 0.3s ease;
}

.nlq-toast.visible {
  opacity: 1;
  transform: translateX(-50%) translateY(0);
  pointer-events: auto;
}

.nlq-toast-accent {
  width: 3px;
  background: var(--accent);
  flex-shrink: 0;
}

.nlq-toast-body {
  padding: 10px 14px;
  flex: 1;
  min-width: 0;
}

.nlq-toast-header {
  display: flex;
  align-items: center;
  gap: 6px;
  margin-bottom: 4px;
}

.nlq-toast-icon {
  color: var(--accent);
  font-size: 10px;
}

.nlq-toast-title {
  font-size: 11px;
  font-weight: 700;
  color: var(--accent);
  letter-spacing: 0.5px;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}

.nlq-toast-count {
  font-family: var(--mono);
  font-size: 10px;
  font-weight: 700;
  color: var(--text-heading);
  background: rgba(45, 114, 210, 0.15);
  padding: 1px 6px;
  border-radius: 2px;
  flex-shrink: 0;
}

.nlq-toast-summary {
  font-size: 11px;
  color: var(--text-secondary);
  line-height: 1.4;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}

.nlq-toast-close {
  background: none;
  border: none;
  color: var(--text-secondary);
  font-size: 16px;
  cursor: pointer;
  padding: 6px 10px;
  align-self: flex-start;
  transition: color 0.15s;
}

.nlq-toast-close:hover {
  color: var(--text-primary);
}

.nav-actions {
  display: flex;
  align-items: center;
  gap: 6px;
  flex-shrink: 0;
}

.nav-actions button {
  background: var(--surface-raised);
  border: 1px solid var(--border);
  color: var(--text-secondary);
  font-size: 10px;
  font-weight: 600;
  letter-spacing: 1px;
  padding: 6px 12px;
  border-radius: 3px;
  cursor: pointer;
  transition: all 0.15s;
}

.nav-actions button:hover {
  color: var(--text-primary);
  border-color: var(--border-active);
  background: var(--surface-raised);
}

#reupload-btn {
  display: none;
}

#pitch-mode-btn.active {
  color: var(--accent-red);
  border-color: rgba(205, 66, 70, 0.3);
  background: rgba(205, 66, 70, 0.08);
}

/* ════════════════════════════════════════════════════════════════
   LEFT SIDEBAR
   ════════════════════════════════════════════════════════════════ */

#sidebar {
  grid-area: side;
  display: flex;
  flex-direction: column;
  background: var(--surface);
  border-right: 1px solid var(--border);
  overflow: hidden;
  z-index: 40;
}

#sidebar-scroll {
  flex: 1;
  overflow-y: auto;
  overflow-x: hidden;
  scrollbar-width: thin;
}

/* Sidebar sections */
.sb-section {
  border-bottom: 1px solid var(--border);
}

.sb-section-header {
  display: flex;
  align-items: center;
  gap: 8px;
  width: 100%;
  padding: 10px 14px;
  background: none;
  border: none;
  color: var(--text-secondary);
  font-size: 10px;
  font-weight: 600;
  letter-spacing: 1.5px;
  text-transform: uppercase;
  cursor: pointer;
  transition: all 0.15s;
  text-align: left;
  font-family: inherit;
}

.sb-section-header:hover {
  background: rgba(255, 255, 255, 0.02);
  color: var(--text-primary);
}

.sb-section-icon {
  color: var(--accent);
  font-size: 12px;
  width: 16px;
  text-align: center;
  flex-shrink: 0;
}

.sb-chevron {
  margin-left: auto;
  font-size: 10px;
  transition: transform 0.2s;
}

.sb-section.collapsed .sb-chevron {
  transform: rotate(-90deg);
}

.sb-section-body {
  padding: 0 14px 12px;
}

.sb-section.collapsed .sb-section-body {
  display: none;
}

/* Sidebar sub-groups */
.sb-sub-group {
  margin-top: 12px;
  padding-top: 10px;
  border-top: 1px solid var(--border);
}

.sb-sub-label {
  font-size: 9px;
  font-weight: 600;
  letter-spacing: 1.5px;
  color: var(--text-secondary);
  text-transform: uppercase;
  margin-bottom: 8px;
}

.sb-control-group {
  margin-bottom: 12px;
}

.sb-control-label {
  font-size: 9px;
  font-weight: 600;
  letter-spacing: 1.5px;
  color: var(--text-secondary);
  text-transform: uppercase;
  margin-bottom: 6px;
}

.sb-action-btn {
  width: 100%;
  padding: 8px 12px;
  background: var(--surface-raised);
  border: 1px solid var(--border);
  border-radius: 3px;
  color: var(--text-primary);
  font-size: 11px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.15s;
}

.sb-action-btn:hover {
  border-color: var(--border-active);
  color: var(--accent);
}

/* Sidebar footer */
#sidebar-footer {
  display: flex;
  gap: 4px;
  padding: 8px 10px;
  border-top: 1px solid var(--border);
  flex-shrink: 0;
}

#sidebar-footer button {
  flex: 1;
  padding: 6px 8px;
  background: var(--surface-raised);
  border: 1px solid var(--border);
  border-radius: 3px;
  color: var(--text-secondary);
  font-size: 9px;
  font-weight: 600;
  letter-spacing: 0.8px;
  cursor: pointer;
  transition: all 0.15s;
}

#sidebar-footer button:hover {
  color: var(--text-primary);
  border-color: var(--border-active);
}

#autopilot-btn.running {
  color: var(--accent-amber);
  border-color: rgba(243, 159, 65, 0.3);
  background: rgba(243, 159, 65, 0.06);
}

#ambience-btn.active {
  color: var(--accent);
  border-color: rgba(45, 114, 210, 0.3);
}

#ambience-btn.muted {
  color: var(--text-secondary);
}

#ambience-btn.ducked {
  color: var(--accent);
  border-color: rgba(45, 114, 210, 0.4);
}

/* ── Legend content (used inside popover) ── */
.legend-head { display: none; }

.legend-callout {
  margin-bottom: 10px;
  padding: 6px 8px;
  border-radius: 3px;
  border: 1px solid var(--border);
  background: var(--surface-raised);
  color: var(--text-secondary);
  font-size: 10px;
  line-height: 1.4;
}

.legend-callout strong {
  color: var(--text-primary);
}

.legend-section { margin-bottom: 4px; }

.legend-section-label {
  font-size: 9px;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 1.3px;
  color: var(--text-secondary);
  margin-bottom: 6px;
  margin-top: 4px;
}

.legend-row {
  display: flex;
  align-items: flex-start;
  gap: 8px;
  margin-bottom: 4px;
}

.legend-row:last-child { margin-bottom: 0; }

.legend-text {
  display: flex;
  flex-direction: column;
  min-width: 0;
}

.legend-label {
  font-size: 11px;
  color: var(--text-primary);
  font-weight: 500;
  line-height: 1.3;
}

.legend-desc {
  font-size: 10px;
  color: var(--text-secondary);
  line-height: 1.3;
}

.legend-swatch {
  display: inline-block;
  width: 12px;
  height: 12px;
  border-radius: 3px;
  border: 1px solid rgba(255, 255, 255, 0.1);
  flex-shrink: 0;
  margin-top: 1px;
}

.legend-account { border-radius: 50%; background: #4488ff; }
.legend-company { background: #aa66ff; }
.legend-diamond {
  width: 10px; height: 10px;
  background: #ff8844;
  transform: rotate(45deg);
  border-radius: 1px;
}
.legend-selected { background: #fff; border-color: rgba(0,0,0,0.3); }

.legend-size-scale {
  display: inline-flex;
  align-items: flex-end;
  gap: 3px;
  width: 40px;
  min-width: 40px;
  margin-top: 2px;
}

.legend-size-dot {
  display: inline-block;
  border-radius: 50%;
  background: rgba(45, 114, 210, 0.7);
}

.legend-size-dot.sm { width: 4px; height: 4px; opacity: 0.5; }
.legend-size-dot.md { width: 7px; height: 7px; opacity: 0.7; }
.legend-size-dot.lg { width: 10px; height: 10px; }

.legend-icon {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  width: 14px; height: 14px;
  font-size: 9px;
  font-weight: 700;
  font-family: var(--mono);
  color: var(--accent);
  border: 1px solid var(--border-active);
  border-radius: 3px;
  background: var(--accent-dim);
  flex-shrink: 0;
}

.legend-jurisdiction-bar {
  display: inline-block;
  width: 40px; height: 10px;
  border-radius: 3px;
  border: 1px solid rgba(255,255,255,0.08);
  background: linear-gradient(90deg, #4488ff, #22aa88, #aa66ff, #ff8844, #44dddd, #ffcc22, #ff5588, #88cc44);
  flex-shrink: 0;
  margin-top: 2px;
}

.legend-glow-icon {
  display: inline-block;
  width: 12px; height: 12px;
  border-radius: 50%;
  background: radial-gradient(circle, rgba(255,100,60,0.9) 20%, transparent 100%);
  flex-shrink: 0;
}

.legend-gradient {
  display: inline-block;
  width: 40px; height: 10px;
  border-radius: 3px;
  border: 1px solid rgba(255,255,255,0.08);
  background: linear-gradient(90deg, #1a3366, #22aa88, #ffaa00, #ff2222);
  flex-shrink: 0;
  margin-top: 2px;
}

.legend-divider {
  height: 1px;
  background: var(--border);
  margin: 8px 0;
}

.legend-footer { display: none; }

/* Time controls (inside sidebar) */
#time-controls {
  position: static;
  display: flex;
  align-items: center;
  gap: 8px;
  background: none;
  padding: 0;
  border-radius: 0;
  border: none;
  backdrop-filter: none;
  z-index: auto;
  transform: none;
}

#time-label {
  font-family: var(--mono);
  font-size: 11px;
  font-weight: 500;
  color: var(--text-primary);
  white-space: nowrap;
  min-width: 60px;
}

#time-slider {
  flex: 1;
  width: 100%;
  accent-color: var(--accent);
}

#khop-select {
  background: var(--base);
  color: var(--text-primary);
  border: 1px solid var(--border);
  border-radius: 4px;
  padding: 4px 6px;
  font-size: 11px;
}

#time-controls label {
  display: none; /* Hidden — label in sb-control-label instead */
}

.control-divider { display: none; }

/* Agent controls (inside sidebar) */
#agent-controls {
  display: flex;
  flex-direction: column;
  gap: 6px;
}

.agent-control {
  display: flex;
  align-items: center;
  gap: 6px;
  font-size: 11px;
  color: var(--text-secondary);
  cursor: pointer;
}

.agent-control input[type="checkbox"] {
  accent-color: var(--accent);
}

.agent-control select {
  background: var(--base);
  border: 1px solid var(--border);
  border-radius: 4px;
  color: var(--text-primary);
  font-size: 11px;
  padding: 3px 6px;
}

/* Agent presets */
#agent-presets {
  display: flex;
  flex-wrap: wrap;
  gap: 4px;
}

.agent-preset-chip {
  background: var(--surface-raised);
  border: 1px solid var(--border);
  border-radius: 4px;
  color: var(--text-secondary);
  font-size: 10px;
  padding: 4px 8px;
  cursor: pointer;
  transition: all 0.15s;
}

.agent-preset-chip:hover {
  color: var(--accent);
  border-color: var(--border-active);
}

/* ── Investigations section ── */
#nlq-result {
  margin-bottom: 8px;
  padding: 8px;
  background: var(--surface-raised);
  border: 1px solid var(--border);
  border-radius: 3px;
}

#nlq-result-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 8px;
  margin-bottom: 4px;
}

#nlq-interpretation {
  font-size: 11px;
  color: var(--accent);
  font-weight: 500;
}

#nlq-summary {
  font-size: 11px;
  color: var(--text-secondary);
  display: block;
}

.panel-collapse-toggle {
  width: 18px; height: 18px;
  border-radius: 3px;
  border: 1px solid var(--border);
  background: none;
  color: var(--text-secondary);
  font-size: 10px;
  cursor: pointer;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  transition: all 0.15s;
}

.panel-collapse-toggle:hover {
  border-color: var(--border-active);
  color: var(--text-primary);
}

/* Agent result */
#agent-result {
  flex-direction: column;
  gap: 8px;
  padding: 8px;
  background: var(--surface-raised);
  border: 1px solid var(--border);
  border-radius: 3px;
}

#agent-result[style*="flex"] {
  display: flex;
}

#agent-status-row {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 8px;
}

#agent-status {
  font-family: var(--mono);
  font-size: 11px;
  font-weight: 500;
  color: var(--text-primary);
}

#agent-status[data-tone="ok"] { color: var(--accent-green); }
#agent-status[data-tone="warn"] { color: var(--accent-amber); }
#agent-status[data-tone="error"] { color: var(--accent-red); }
#agent-status[data-live="1"] { color: var(--accent); }

#agent-run-id {
  font-family: var(--mono);
  font-size: 9px;
  color: var(--text-secondary);
}

#agent-progress-track {
  height: 3px;
  background: rgba(45, 114, 210, 0.12);
  border-radius: 2px;
  overflow: hidden;
}

#agent-progress-fill {
  height: 100%;
  width: 0%;
  background: var(--accent);
  border-radius: 2px;
  transition: width 0.3s ease;
}

#agent-steps {
  display: flex;
  gap: 4px;
  flex-wrap: wrap;
}

.agent-step-pill {
  display: inline-flex;
  align-items: center;
  gap: 4px;
  padding: 3px 8px;
  border-radius: 4px;
  font-size: 10px;
  font-weight: 500;
  border: 1px solid var(--border);
  background: var(--base);
  color: var(--text-secondary);
  transition: all 0.15s;
}

.agent-step-pill.running {
  color: var(--accent);
  border-color: rgba(45, 114, 210, 0.3);
  background: rgba(45, 114, 210, 0.08);
}

.agent-step-pill.completed {
  color: var(--accent-green);
  border-color: rgba(35, 133, 81, 0.25);
  background: rgba(35, 133, 81, 0.06);
}

.agent-step-pill.failed {
  color: var(--accent-red);
  border-color: rgba(205, 66, 70, 0.25);
}

.agent-step-index {
  font-family: var(--mono);
  font-size: 9px;
  opacity: 0.6;
}

.agent-step-name { font-weight: 600; }

#agent-metrics {
  font-size: 10px;
  color: var(--text-secondary);
  font-family: var(--mono);
}

#agent-top-entities {
  display: flex;
  flex-wrap: wrap;
  gap: 4px;
}

.agent-entity-chip {
  background: var(--base);
  border: 1px solid var(--border);
  border-radius: 4px;
  color: var(--accent);
  font-family: var(--mono);
  font-size: 10px;
  padding: 3px 6px;
  cursor: pointer;
  transition: all 0.15s;
}

.agent-entity-chip:hover {
  border-color: var(--border-active);
  background: var(--accent-dim);
}

#agent-summary {
  max-height: 200px;
  overflow-y: auto;
  font-size: 11px;
  line-height: 1.5;
  color: var(--text-primary);
  scrollbar-width: thin;
}

#agent-result[data-collapsed="1"] #agent-steps,
#agent-result[data-collapsed="1"] #agent-metrics,
#agent-result[data-collapsed="1"] #agent-top-entities,
#agent-result[data-collapsed="1"] #agent-summary,
#agent-result[data-collapsed="1"] #agent-history {
  display: none;
}

/* Agent history */
.agent-history-title {
  font-size: 9px;
  font-weight: 600;
  letter-spacing: 1px;
  color: var(--text-secondary);
  text-transform: uppercase;
  margin-bottom: 4px;
}

.agent-history-row {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 4px 6px;
  border-radius: 4px;
  cursor: pointer;
  transition: background 0.15s;
  font-size: 10px;
}

.agent-history-row:hover {
  background: var(--base);
}

.agent-history-state {
  font-family: var(--mono);
  font-size: 9px;
  color: var(--text-secondary);
  min-width: 80px;
}

.agent-history-query {
  color: var(--text-primary);
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}

/* ════════════════════════════════════════════════════════════════
   MAIN VIEWPORT
   ════════════════════════════════════════════════════════════════ */

#viewport {
  grid-area: viewport;
  position: relative;
  overflow: hidden;
  background: var(--base);
}

/* ── Viewport Overlay (legend trigger + camera presets) ── */
#viewport-overlay {
  position: absolute;
  inset: 0;
  pointer-events: none;
  z-index: 4;
}

#viewport-top-right {
  position: absolute;
  top: 10px;
  right: 10px;
  display: flex;
  gap: 4px;
  align-items: center;
  pointer-events: auto;
}

#legend-trigger {
  background: rgba(10, 14, 19, 0.85);
  border: 1px solid var(--border);
  color: var(--text-secondary);
  font-size: 9px;
  font-weight: 600;
  letter-spacing: 0.8px;
  padding: 5px 10px;
  border-radius: 3px;
  cursor: pointer;
  transition: all 0.15s;
}

#legend-trigger:hover {
  color: var(--text-primary);
  border-color: var(--border-active);
}

#camera-presets {
  display: flex;
  gap: 4px;
}

#camera-presets button {
  background: rgba(10, 14, 19, 0.85);
  border: 1px solid var(--border);
  color: var(--text-secondary);
  font-size: 9px;
  font-weight: 600;
  letter-spacing: 0.5px;
  padding: 5px 8px;
  border-radius: 3px;
  cursor: pointer;
  transition: all 0.15s;
}

#camera-presets button:hover {
  color: var(--text-primary);
  border-color: var(--border-active);
  background: rgba(10, 14, 19, 0.95);
}

/* ── Legend Popover ── */
#legend-popover {
  position: absolute;
  top: 40px;
  right: 10px;
  width: 280px;
  max-height: calc(100% - 60px);
  overflow-y: auto;
  background: rgba(17, 20, 24, 0.96);
  border: 1px solid var(--border-active);
  border-radius: 3px;
  padding: 12px 14px;
  z-index: 10;
  pointer-events: auto;
  scrollbar-width: thin;
}

#legend-popover.hidden {
  display: none;
}

.popover-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-bottom: 10px;
}

.popover-title {
  font-size: 10px;
  font-weight: 600;
  letter-spacing: 1.5px;
  color: var(--text-secondary);
  text-transform: uppercase;
}

.popover-close {
  background: none;
  border: none;
  color: var(--text-secondary);
  font-size: 16px;
  cursor: pointer;
  padding: 0 4px;
}

.popover-close:hover {
  color: var(--text-primary);
}

/* Legend inside popover — reset sidebar overrides */
#legend {
  position: static;
  width: auto;
  max-height: none;
  overflow: visible;
  background: none;
  border: none;
  border-radius: 0;
  box-shadow: none;
  padding: 0;
}

#scene-canvas {
  display: block;
  width: 100%;
  height: 100%;
}

/* Cluster labels */
#cluster-labels {
  position: absolute;
  top: 0; left: 0;
  width: 100%; height: 100%;
  pointer-events: none;
  z-index: 3;
}

.cluster-label {
  position: absolute;
  transform: translate(-50%, -100%);
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 2px;
  padding: 4px 10px;
  background: rgba(10, 14, 19, 0.92);
  border: 1px solid rgba(45, 114, 210, 0.25);
  border-radius: 3px;
  white-space: nowrap;
}

.cl-name {
  font-size: 10px;
  font-weight: 700;
  text-transform: uppercase;
  letter-spacing: 1.5px;
  color: var(--accent-amber);
}

.cl-stats {
  font-size: 9px;
  color: var(--text-secondary);
  font-family: var(--mono);
}

/* Node risk score labels */
#node-risk-labels {
  position: absolute;
  top: 0; left: 0;
  width: 100%; height: 100%;
  pointer-events: none;
  z-index: 4;
}

.node-risk-label {
  position: absolute;
  transform: translate(-50%, -100%);
  font-family: var(--mono);
  font-size: 9px;
  font-weight: 700;
  padding: 1px 4px;
  border-radius: 2px;
  background: rgba(10, 14, 19, 0.85);
  border: 1px solid rgba(255, 255, 255, 0.08);
  white-space: nowrap;
  letter-spacing: 0.5px;
}

/* Autopilot overlay */
#autopilot-overlay {
  position: absolute;
  bottom: 60px;
  left: 50%;
  transform: translateX(-50%);
  background: rgba(10, 14, 19, 0.92);
  border: 1px solid var(--border-active);
  border-radius: 3px;
  padding: 10px 20px;
  font-size: 12px;
  color: var(--text-primary);
  z-index: 5;
  max-width: 460px;
  text-align: left;
  transition: opacity 0.4s ease;
}

#autopilot-overlay p { margin: 0 0 4px; font-size: 11px; line-height: 1.4; }
#autopilot-overlay h1, #autopilot-overlay h2, #autopilot-overlay h3 {
  margin: 0 0 4px; font-size: 12px; color: var(--text-heading);
}
#autopilot-overlay .entity-link, #autopilot-overlay a {
  color: var(--accent); text-decoration: underline;
}
#autopilot-overlay.fade-in { opacity: 1; }
#autopilot-overlay.fade-out { opacity: 0; }

/* Node tooltip */
#node-tooltip {
  position: fixed;
  pointer-events: none;
  background: rgba(10, 14, 19, 0.95);
  border: 1px solid var(--border-active);
  border-radius: 3px;
  padding: 6px 10px;
  z-index: 100;
  font-size: 11px;
  max-width: 200px;
  white-space: nowrap;
}

.tooltip-id { font-family: var(--mono); font-size: 10px; color: var(--accent); margin-bottom: 2px; }
.tooltip-risk { font-weight: 700; font-size: 12px; }
.tooltip-type { font-size: 9px; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.5px; }
.tooltip-vol { font-size: 10px; color: var(--accent-green); font-family: var(--mono); }

/* ════════════════════════════════════════════════════════════════
   RIGHT DETAIL PANEL (Entity + SAR)
   ════════════════════════════════════════════════════════════════ */

#entity-panel {
  grid-area: detail;
  background: var(--surface);
  border-left: 1px solid var(--border);
  padding: 16px;
  overflow-y: auto;
  overflow-x: hidden;
  scrollbar-width: thin;
  display: none;
}

body.detail-open #entity-panel {
  display: block;
}

#panel-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 12px;
}

#panel-header h2 {
  font-size: 12px;
  font-weight: 600;
  letter-spacing: 1px;
  text-transform: uppercase;
  color: var(--text-heading);
}

#panel-close {
  background: none;
  border: none;
  color: var(--text-secondary);
  font-size: 20px;
  cursor: pointer;
  padding: 0 4px;
}

#panel-close:hover { color: var(--text-primary); }

/* Panel tabs */
#panel-tabs {
  display: flex;
  gap: 0;
  margin-bottom: 12px;
  border-bottom: 1px solid var(--border);
}

.panel-tab {
  flex: 1;
  padding: 8px 4px;
  background: none;
  border: none;
  border-bottom: 2px solid transparent;
  color: var(--text-secondary);
  font-size: 10px;
  font-weight: 600;
  letter-spacing: 0.8px;
  text-transform: uppercase;
  cursor: pointer;
  transition: all 0.15s;
  text-align: center;
  font-family: inherit;
}

.panel-tab:hover {
  color: var(--text-primary);
  background: rgba(255, 255, 255, 0.02);
}

.panel-tab.active {
  color: var(--accent);
  border-bottom-color: var(--accent);
}

.panel-tab-content {
  display: none;
}

.panel-tab-content.active {
  display: block;
}

/* Entity panel content */
.entity-context-row {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 8px;
  margin-bottom: 8px;
}

.entity-id {
  font-family: var(--mono);
  font-size: 12px;
  color: var(--accent);
  word-break: break-all;
}

.entity-context-row .entity-id { margin-bottom: 0; }

.bucket-chip {
  display: inline-flex;
  padding: 2px 6px;
  border-radius: 3px;
  font-family: var(--mono);
  font-size: 9px;
  font-weight: 500;
  color: var(--text-secondary);
  background: var(--surface-raised);
  border: 1px solid var(--border);
  white-space: nowrap;
}

.entity-quick-guide {
  margin-bottom: 10px;
  padding: 6px 8px;
  border-radius: 3px;
  border: 1px solid var(--border);
  background: var(--surface-raised);
  font-size: 10px;
  color: var(--text-secondary);
  line-height: 1.4;
}

.stat-row {
  display: flex;
  gap: 4px;
  flex-wrap: wrap;
  margin-bottom: 10px;
}

.badge {
  font-family: var(--mono);
  font-size: 10px;
  padding: 2px 6px;
  border-radius: 3px;
  background: var(--surface-raised);
  border: 1px solid var(--border);
  color: var(--text-secondary);
}

/* Risk score */
.risk-score { margin-bottom: 14px; }
.risk-score label {
  font-size: 10px;
  color: var(--text-secondary);
  display: block;
  margin-bottom: 4px;
  text-transform: uppercase;
  letter-spacing: 1px;
  font-weight: 600;
}

.soft-tip {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  width: 13px; height: 13px;
  margin-left: 4px;
  border-radius: 50%;
  font-size: 8px;
  font-weight: 700;
  color: var(--text-secondary);
  border: 1px solid var(--border);
  background: var(--surface-raised);
  cursor: help;
  vertical-align: middle;
}

.risk-number-row {
  display: flex;
  align-items: center;
  gap: 8px;
}

.risk-number {
  font-size: 28px;
  font-family: var(--mono);
  font-weight: 800;
  margin-bottom: 4px;
}

.risk-band {
  display: inline-block;
  padding: 2px 8px;
  border-radius: 3px;
  font-family: var(--mono);
  font-size: 9px;
  font-weight: 700;
  letter-spacing: 0.5px;
  border: 1px solid transparent;
}

.risk-band-low { color: var(--accent-green); border-color: rgba(35,133,81,0.25); background: rgba(35,133,81,0.08); }
.risk-band-guarded { color: var(--accent-amber); border-color: rgba(243,159,65,0.25); background: rgba(243,159,65,0.08); }
.risk-band-elevated { color: #E87040; border-color: rgba(232,112,64,0.25); background: rgba(232,112,64,0.08); }
.risk-band-critical { color: var(--accent-red); border-color: rgba(205,66,70,0.25); background: rgba(205,66,70,0.08); }

.risk-bar {
  height: 4px;
  background: rgba(255,255,255,0.06);
  border-radius: 2px;
  overflow: hidden;
  margin-bottom: 4px;
}

.risk-fill {
  height: 100%;
  background: linear-gradient(90deg, var(--accent-green), var(--accent-amber), var(--accent-red));
  border-radius: 2px;
  transition: width 0.3s ease;
}

.risk-score span { font-size: 11px; color: var(--text-secondary); }

#panel-content h3 {
  font-size: 11px;
  font-weight: 600;
  margin-bottom: 6px;
  color: var(--text-heading);
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.muted { color: var(--text-secondary); font-size: 11px; }
.soft-copy { color: var(--text-secondary); font-size: 10px; line-height: 1.4; }
.soft-copy em { color: var(--text-primary); }

/* Activity section */
.activity-section { margin-bottom: 14px; }

.activity-grid {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 6px;
  margin-top: 6px;
}

.activity-card {
  border: 1px solid var(--border);
  border-radius: 3px;
  background: var(--surface-raised);
  padding: 6px 8px;
}

.activity-label {
  display: block;
  font-size: 9px;
  text-transform: uppercase;
  letter-spacing: 0.5px;
  color: var(--text-secondary);
  margin-bottom: 2px;
}

.activity-value {
  display: block;
  font-size: 12px;
  font-family: var(--mono);
  font-weight: 700;
  color: var(--text-heading);
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}

.activity-meta {
  display: block;
  margin-top: 1px;
  font-size: 9px;
  color: var(--text-secondary);
}

.activity-net-positive { color: var(--accent-green); }
.activity-net-negative { color: var(--accent-red); }

/* AI section */
.ai-section {
  margin-top: 14px;
  padding-top: 10px;
  border-top: 1px solid var(--border);
}

.ai-summary {
  font-size: 11px;
  line-height: 1.5;
  color: var(--text-primary);
  background: var(--surface-raised);
  border: 1px solid var(--border);
  border-radius: 3px;
  padding: 8px 10px;
}

/* Markdown content */
.markdown-content { overflow-wrap: anywhere; }
.markdown-content p { margin: 0 0 6px; }
.markdown-content p:last-child { margin-bottom: 0; }
.markdown-content h1, .markdown-content h2, .markdown-content h3, .markdown-content h4 {
  margin: 8px 0 4px;
  color: var(--text-heading);
  font-size: 12px;
  font-weight: 700;
}
.markdown-content ul, .markdown-content ol { margin: 0 0 6px 16px; padding: 0; }
.markdown-content li { margin: 2px 0; }
.markdown-content strong { color: var(--text-heading); }
.markdown-content code {
  font-family: var(--mono);
  background: var(--base);
  border-radius: 3px;
  padding: 1px 4px;
  font-size: 11px;
}
.markdown-content pre {
  margin: 6px 0;
  background: var(--base);
  border: 1px solid var(--border);
  border-radius: 3px;
  padding: 8px 10px;
  overflow: auto;
}
.markdown-content pre code { background: transparent; padding: 0; }
.markdown-content blockquote {
  margin: 6px 0;
  padding: 0 0 0 10px;
  border-left: 2px solid var(--accent);
  color: var(--text-secondary);
}
.markdown-content a { color: var(--accent); text-decoration: underline; }

/* Attribution bar */
.attribution { margin-bottom: 14px; }
.attribution-explainer { margin-bottom: 6px; }

.attr-bar {
  display: flex;
  height: 6px;
  border-radius: 3px;
  overflow: hidden;
  background: rgba(255,255,255,0.04);
  margin-bottom: 4px;
}

.attr-segment { height: 100%; transition: width 0.3s ease; }
.attr-labels { display: flex; flex-wrap: wrap; gap: 6px; }
.attr-label { display: inline-flex; align-items: center; gap: 3px; font-size: 10px; color: var(--text-secondary); }
.attr-dot { display: inline-block; width: 5px; height: 5px; border-radius: 50%; }

/* Evidence cards */
.evidence-section { margin-bottom: 14px; }

.evidence-card {
  background: var(--surface-raised);
  border: 1px solid var(--border);
  border-radius: 3px;
  padding: 8px 10px;
  margin-bottom: 6px;
}

.evidence-title {
  font-size: 10px;
  font-weight: 700;
  text-transform: uppercase;
  letter-spacing: 0.8px;
  margin-bottom: 6px;
}

.evidence-explainer { font-size: 10px; color: var(--text-secondary); line-height: 1.4; margin-bottom: 6px; }
.evidence-stats { display: flex; gap: 14px; margin-bottom: 4px; }
.evidence-stat { display: flex; flex-direction: column; }
.evidence-value { font-size: 16px; font-weight: 700; font-family: var(--mono); color: var(--text-heading); }
.evidence-label { font-size: 9px; color: var(--text-secondary); }
.evidence-context { font-size: 9px; color: var(--text-secondary); border-top: 1px solid var(--border); padding-top: 4px; margin-top: 2px; }
.evidence-link-row { display: flex; flex-wrap: wrap; gap: 4px; margin-top: 4px; }

.evidence-entity-link {
  background: var(--base);
  border: 1px solid var(--border);
  border-radius: 3px;
  color: var(--accent);
  font-size: 9px;
  font-family: var(--mono);
  padding: 2px 5px;
  cursor: pointer;
}

.evidence-entity-link:hover { border-color: var(--border-active); }
.evidence-link-more { font-size: 9px; color: var(--text-secondary); }

/* Flagged transactions */
.flagged-section { margin-bottom: 14px; }

.flagged-list {
  max-height: 100px;
  overflow-y: auto;
  border: 1px solid var(--border);
  border-radius: 4px;
  padding: 4px;
  background: var(--base);
  scrollbar-width: thin;
}

.flagged-summary { display: flex; flex-wrap: wrap; gap: 4px; margin: 6px 0; }

.flagged-chip {
  display: inline-flex;
  padding: 2px 6px;
  border-radius: 3px;
  font-size: 9px;
  color: var(--text-secondary);
  border: 1px solid var(--border);
  background: var(--surface-raised);
}

.flagged-tx-btn {
  width: 100%;
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 6px;
  border: 1px solid var(--border);
  border-radius: 3px;
  background: var(--surface-raised);
  padding: 3px 6px;
  cursor: pointer;
  transition: background 0.15s;
  margin-bottom: 2px;
}

.flagged-tx-btn:hover { background: var(--surface); border-color: var(--border-active); }

.flagged-tx {
  font-family: var(--mono);
  font-size: 9px;
  color: var(--text-primary);
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}

.flagged-tx-copy {
  font-size: 8px;
  color: var(--text-secondary);
  white-space: nowrap;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.flagged-more { margin-top: 4px; }

/* Connected entities */
.connected-section { margin-bottom: 14px; }
.connected-help { font-weight: 400; color: var(--text-secondary); font-size: 10px; }

.connected-row {
  padding: 6px 8px;
  background: var(--surface-raised);
  border: 1px solid var(--border);
  border-radius: 3px;
  margin-bottom: 4px;
}

.connected-main-row { display: flex; align-items: center; gap: 6px; margin-bottom: 3px; }

.connected-entity-link {
  background: none;
  border: none;
  color: var(--accent);
  font-family: var(--mono);
  font-size: 10px;
  cursor: pointer;
  padding: 0;
  text-decoration: underline;
}

.connected-entity-link:hover { color: var(--text-heading); }

.connected-relation {
  font-size: 9px;
  color: var(--text-secondary);
  padding: 1px 4px;
  border-radius: 2px;
  background: var(--base);
  border: 1px solid var(--border);
}

.connected-relation.direct { color: var(--accent-green); border-color: rgba(35,133,81,0.2); }
.connected-pct { font-family: var(--mono); font-size: 11px; font-weight: 700; margin-left: auto; }

.connected-risk-bar {
  height: 2px;
  background: rgba(255,255,255,0.04);
  border-radius: 1px;
  overflow: hidden;
  margin-bottom: 3px;
}

.connected-risk-fill { height: 100%; border-radius: 1px; transition: width 0.3s; }

.connected-flow-row { display: flex; gap: 8px; }
.connected-flow { font-size: 9px; font-family: var(--mono); color: var(--text-secondary); }
.connected-flow.in { color: var(--accent-green); }
.connected-flow.out { color: var(--accent-red); }
.connected-flow.net.pos { color: var(--accent-green); }
.connected-flow.net.neg { color: var(--accent-red); }

/* SAR + Counterfactual buttons */
.panel-sar-btn,
.panel-cf-btn {
  width: 100%;
  margin-top: 10px;
  padding: 8px 12px;
  font-size: 10px;
  font-weight: 600;
  letter-spacing: 1px;
  text-transform: uppercase;
  border-radius: 3px;
  cursor: pointer;
  transition: all 0.15s;
  background: var(--surface-raised);
  border: 1px solid var(--border);
  color: var(--text-primary);
}

.panel-sar-btn:hover { border-color: var(--accent-green); color: var(--accent-green); }
.panel-cf-btn:hover { border-color: var(--accent-purple); color: var(--accent-purple); }
.panel-cf-btn.active { color: var(--accent-amber); border-color: rgba(243,159,65,0.3); }

/* ════════════════════════════════════════════════════════════════
   SAR PANEL (Separate overlay — left side)
   ════════════════════════════════════════════════════════════════ */

#sar-panel {
  position: fixed;
  top: var(--nav-h);
  left: calc(-460px - var(--sidebar-w));
  width: 460px;
  height: calc(100vh - var(--nav-h) - var(--footer-h));
  background: var(--surface);
  border-right: 1px solid var(--border);
  padding: 16px;
  overflow-y: auto;
  transition: left 0.25s ease;
  z-index: 45;
  scrollbar-width: thin;
}

#sar-panel.open {
  left: var(--sidebar-w);
}

#sar-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 12px;
}

#sar-header h2 {
  font-size: 12px;
  font-weight: 600;
  letter-spacing: 1px;
  text-transform: uppercase;
  color: var(--accent-green);
}

#sar-close {
  background: none;
  border: none;
  color: var(--text-secondary);
  font-size: 20px;
  cursor: pointer;
}

#sar-close:hover { color: var(--text-primary); }

.sar-header-info {
  display: flex;
  gap: 14px;
  flex-wrap: wrap;
  margin-bottom: 12px;
  padding-bottom: 10px;
  border-bottom: 1px solid var(--border);
}

.sar-meta { display: flex; flex-direction: column; }
.sar-label { font-size: 9px; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 1px; }
.sar-value { font-size: 13px; font-weight: 600; color: var(--text-heading); font-family: var(--mono); }

.sar-entity-link {
  background: transparent; border: 0; padding: 0;
  color: var(--accent); font-size: 13px; font-weight: 700;
  font-family: var(--mono); text-decoration: underline; cursor: pointer;
}
.sar-entity-link:hover { color: var(--text-heading); }
.sar-risk { color: var(--accent-amber); }

.sar-narrative {
  font-size: 12px;
  line-height: 1.6;
  color: var(--text-primary);
  background: var(--surface-raised);
  border: 1px solid var(--border);
  border-radius: 3px;
  padding: 12px;
  margin-bottom: 12px;
}

.sar-hint { font-size: 10px; color: var(--text-secondary); margin-bottom: 8px; }
.sar-actions { display: flex; gap: 6px; flex-wrap: wrap; }

.sar-btn {
  flex: 1;
  padding: 7px 12px;
  font-size: 10px;
  font-weight: 600;
  letter-spacing: 0.8px;
  text-transform: uppercase;
  border-radius: 3px;
  cursor: pointer;
  transition: all 0.15s;
  background: var(--surface-raised);
  border: 1px solid var(--border);
  color: var(--text-primary);
}

.sar-btn:hover { border-color: var(--border-active); color: var(--accent); }
.sar-btn-secondary { color: var(--text-secondary); }

.sar-loading { display: flex; flex-direction: column; align-items: center; gap: 10px; padding: 30px 0; }

.sar-spinner {
  width: 24px; height: 24px;
  border: 2px solid var(--border);
  border-top-color: var(--accent);
  border-radius: 50%;
  animation: spin 0.8s linear infinite;
}

@keyframes spin { to { transform: rotate(360deg); } }

.sar-loading-text { font-size: 11px; color: var(--text-secondary); }
.sar-error { color: var(--accent-red); font-size: 12px; padding: 20px 0; text-align: center; }

/* ════════════════════════════════════════════════════════════════
   AGENT INVESTIGATION PANEL
   ════════════════════════════════════════════════════════════════ */

#agent-panel {
  position: fixed;
  top: var(--nav-h);
  right: -540px;
  width: 520px;
  height: calc(100vh - var(--nav-h) - var(--footer-h));
  background: var(--surface);
  border-left: 1px solid var(--border);
  z-index: 46;
  overflow-y: auto;
  scrollbar-width: thin;
  display: flex;
  flex-direction: column;
  transition: right 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

#agent-panel.open { right: 0; }

#agent-panel-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 12px 16px;
  border-bottom: 1px solid var(--border);
  flex-shrink: 0;
}

#agent-panel-header h2 {
  font-size: 11px;
  font-weight: 700;
  letter-spacing: 2px;
  text-transform: uppercase;
  color: var(--accent);
  margin: 0;
}

#agent-panel.processing #agent-panel-header h2 {
  animation: ap-header-pulse 2s ease-in-out infinite;
}

@keyframes ap-header-pulse {
  0%, 100% { opacity: 0.7; }
  50% { opacity: 1; text-shadow: 0 0 8px rgba(45, 114, 210, 0.3); }
}

.agent-panel-title-row { display: flex; align-items: center; gap: 8px; }
.agent-panel-icon { color: var(--accent); font-size: 14px; }
.agent-panel-run-id { font-family: var(--mono); font-size: 9px; color: var(--text-secondary); }

#agent-panel-header button {
  background: none;
  border: none;
  color: var(--text-secondary);
  font-size: 18px;
  cursor: pointer;
  padding: 4px 8px;
}

#agent-panel-header button:hover { color: var(--text-primary); }

/* Query bar */
#agent-panel-query-bar {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 10px 16px;
  background: var(--base);
  font-family: var(--mono);
  font-size: 11px;
}

.agent-panel-label {
  font-size: 9px;
  font-weight: 600;
  letter-spacing: 1px;
  color: var(--text-secondary);
  text-transform: uppercase;
  flex-shrink: 0;
}

#agent-panel-query-text {
  color: var(--text-heading);
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}

/* Progress bar */
#agent-panel-progress-track {
  height: 2px;
  background: rgba(45, 114, 210, 0.12);
  overflow: hidden;
}

#agent-panel-progress-fill {
  height: 100%;
  width: 0%;
  background: linear-gradient(90deg, var(--accent), var(--accent-purple));
  transition: width 0.4s ease;
  position: relative;
}

#agent-panel-progress-fill::after {
  content: "";
  position: absolute;
  inset: 0;
  background: linear-gradient(
    90deg,
    transparent 0%,
    rgba(255, 255, 255, 0.25) 50%,
    transparent 100%
  );
  background-size: 200% 100%;
  animation: ap-shimmer 1.5s ease-in-out infinite;
}

@keyframes ap-shimmer {
  0% { background-position: 200% 0; }
  100% { background-position: -200% 0; }
}

/* Step cards */
.ap-step {
  padding: 12px 16px;
  border-bottom: 1px solid var(--border);
  border-left: 2px solid transparent;
  transition: background 0.3s, border-left-color 0.3s, box-shadow 0.3s, opacity 0.3s;
  opacity: 0.5;
}

.ap-step.running {
  background: rgba(45, 114, 210, 0.08);
  border-left-color: var(--accent);
  box-shadow: inset 0 0 20px rgba(45, 114, 210, 0.06);
  opacity: 1;
  animation: ap-step-in 0.4s ease-out;
}

.ap-step.completed {
  border-left-color: var(--accent-green);
  opacity: 1;
}

.ap-step.failed {
  border-left-color: var(--accent-red);
  opacity: 1;
}

@keyframes ap-step-in {
  from { transform: translateX(-8px); opacity: 0.3; }
  to { transform: translateX(0); opacity: 1; }
}

.ap-step-header { display: flex; align-items: center; gap: 10px; }

.ap-step-indicator {
  width: 28px;
  height: 28px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  flex-shrink: 0;
  border: 1px solid var(--border);
  background: var(--base);
  font-family: var(--mono);
  font-size: 11px;
  font-weight: 700;
  color: var(--text-secondary);
  transition: all 0.3s;
}

.ap-step.running .ap-step-indicator {
  border-color: var(--accent);
  background: var(--accent-dim);
  color: var(--accent);
  animation: ap-pulse 1.5s ease-in-out infinite;
}

.ap-step.completed .ap-step-indicator {
  border-color: var(--accent-green);
  background: rgba(35, 133, 81, 0.12);
  color: var(--accent-green);
  animation: ap-check-flash 0.5s ease-out;
}

@keyframes ap-check-flash {
  0% { box-shadow: 0 0 0 0 rgba(35, 133, 81, 0.5); background: rgba(35, 133, 81, 0.35); }
  100% { box-shadow: 0 0 0 8px rgba(35, 133, 81, 0); background: rgba(35, 133, 81, 0.12); }
}

.ap-step.failed .ap-step-indicator {
  border-color: var(--accent-red);
  color: var(--accent-red);
}

@keyframes ap-pulse {
  0%, 100% { box-shadow: 0 0 0 0 rgba(45, 114, 210, 0.3); }
  50% { box-shadow: 0 0 0 6px rgba(45, 114, 210, 0); }
}

.ap-step-info { flex: 1; min-width: 0; }
.ap-step-label { font-size: 11px; font-weight: 700; text-transform: uppercase; letter-spacing: 0.5px; color: var(--text-heading); }
.ap-step-desc { font-size: 10px; color: var(--text-secondary); margin-top: 1px; }

.ap-step-status {
  font-family: var(--mono);
  font-size: 9px;
  font-weight: 600;
  letter-spacing: 1px;
  flex-shrink: 0;
}

.ap-step.running .ap-step-status { color: var(--accent); }
.ap-step.completed .ap-step-status { color: var(--accent-green); }
.ap-step.failed .ap-step-status { color: var(--accent-red); }

.ap-step-cue {
  font-family: var(--mono);
  font-size: 10px;
  color: var(--accent);
  padding: 6px 0 0 38px;
  opacity: 0.8;
  min-height: 16px;
}

.ap-step-cue::after {
  content: "\2588";
  animation: ap-blink 0.8s step-end infinite;
  margin-left: 2px;
}

@keyframes ap-blink {
  0%, 100% { opacity: 1; }
  50% { opacity: 0; }
}

/* Scanline overlay on processing view */
#agent-panel-processing {
  position: relative;
}

#agent-panel-processing::after {
  content: "";
  position: absolute;
  inset: 0;
  pointer-events: none;
  background: repeating-linear-gradient(
    0deg,
    transparent 0px,
    transparent 2px,
    rgba(255, 255, 255, 0.015) 2px,
    rgba(255, 255, 255, 0.015) 3px
  );
  z-index: 1;
}

/* Live feed */
#agent-panel-live-feed {
  max-height: 150px;
  overflow-y: auto;
  padding: 8px 16px;
  background: var(--base);
  border-top: 1px solid var(--border);
  border-bottom: 1px solid var(--border);
  font-family: var(--mono);
  font-size: 10px;
  scrollbar-width: thin;
}

.ap-feed-line {
  display: flex;
  gap: 8px;
  padding: 2px 0;
  border-left: 2px solid transparent;
  animation: ap-feed-in 0.3s ease, ap-feed-glow 1.2s ease-out;
}

@keyframes ap-feed-in {
  from { opacity: 0; transform: translateX(-6px); }
  to { opacity: 1; transform: translateX(0); }
}

@keyframes ap-feed-glow {
  0% { border-left-color: var(--accent); background: rgba(45, 114, 210, 0.08); }
  100% { border-left-color: transparent; background: transparent; }
}

.ap-feed-ts { color: var(--text-disabled, #444); min-width: 40px; flex-shrink: 0; }
.ap-feed-agent { color: var(--accent); font-weight: 600; text-transform: uppercase; min-width: 70px; flex-shrink: 0; }
.ap-feed-detail { color: var(--text-secondary); overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }

/* Elapsed */
#agent-panel-elapsed {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 6px 16px;
  font-family: var(--mono);
}

#agent-panel-timer {
  font-size: 12px;
  font-weight: 700;
  color: var(--accent);
  font-variant-numeric: tabular-nums;
}

/* Result tabs */
#agent-panel-tabs {
  display: flex;
  border-bottom: 1px solid var(--border);
  padding: 0 16px;
  flex-shrink: 0;
}

.agent-panel-tab {
  padding: 8px 14px;
  font-size: 10px;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.8px;
  color: var(--text-secondary);
  background: none;
  border: none;
  border-bottom: 2px solid transparent;
  cursor: pointer;
  transition: all 0.15s;
}

.agent-panel-tab:hover { color: var(--text-primary); }
.agent-panel-tab.active { color: var(--accent); border-bottom-color: var(--accent); }

.agent-panel-tab-content { display: none; padding: 16px; overflow-y: auto; flex: 1; }
.agent-panel-tab-content.active { display: block; }

/* Results reveal animation */
#agent-panel-results.ap-revealing {
  animation: ap-results-in 0.5s ease-out;
}

@keyframes ap-results-in {
  from { opacity: 0; transform: translateY(12px); }
  to { opacity: 1; transform: translateY(0); }
}

/* Intent card */
.ap-intent-card {
  display: flex;
  gap: 8px;
  align-items: baseline;
  padding: 10px;
  background: var(--surface-raised);
  border: 1px solid var(--border);
  border-radius: 3px;
  margin-bottom: 12px;
}

.ap-intent-label {
  font-size: 9px;
  font-weight: 600;
  letter-spacing: 1px;
  color: var(--accent);
  text-transform: uppercase;
  flex-shrink: 0;
}

.ap-intent-text { font-size: 12px; color: var(--text-primary); }

/* Metrics grid */
.ap-metrics-grid {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 8px;
  margin-bottom: 14px;
}

.ap-metric-card {
  background: var(--surface-raised);
  border: 1px solid var(--border);
  border-radius: 3px;
  padding: 10px;
  text-align: center;
  animation: ap-metric-in 0.4s ease-out both;
}

.ap-metric-card:nth-child(1) { animation-delay: 0ms; }
.ap-metric-card:nth-child(2) { animation-delay: 120ms; }
.ap-metric-card:nth-child(3) { animation-delay: 240ms; }

@keyframes ap-metric-in {
  from { opacity: 0; transform: scale(0.9) translateY(6px); }
  to { opacity: 1; transform: scale(1) translateY(0); }
}

.ap-metric-value {
  font-family: var(--mono);
  font-size: 20px;
  font-weight: 800;
  color: var(--text-heading);
}

.ap-metric-label {
  font-size: 9px;
  font-weight: 600;
  color: var(--text-secondary);
  text-transform: uppercase;
  letter-spacing: 0.8px;
  margin-top: 2px;
}

/* Detectors */
.ap-section-title {
  font-size: 10px;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 1px;
  color: var(--text-secondary);
  margin-bottom: 6px;
}

.ap-detector-list { display: flex; flex-wrap: wrap; gap: 4px; margin-bottom: 14px; }

.ap-detector-chip {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  padding: 3px 8px;
  background: var(--surface-raised);
  border: 1px solid var(--border);
  border-radius: 3px;
  font-size: 10px;
}

.ap-detector-name { color: var(--text-secondary); }
.ap-detector-count { font-family: var(--mono); font-weight: 700; color: var(--accent-amber); }

/* Entity cards */
.ap-entity-card.ap-card-reveal {
  animation: ap-card-in 0.35s ease-out both;
}

@keyframes ap-card-in {
  from { opacity: 0; transform: translateY(8px); }
  to { opacity: 1; transform: translateY(0); }
}

.ap-entity-card {
  background: var(--surface-raised);
  border: 1px solid var(--border);
  border-radius: 3px;
  padding: 12px;
  margin-bottom: 8px;
  cursor: pointer;
  transition: border-color 0.15s;
}

.ap-entity-card:hover { border-color: var(--border-active); }

.ap-entity-card-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-bottom: 6px;
}

.ap-entity-id { font-family: var(--mono); font-size: 12px; font-weight: 700; color: var(--accent); }

.ap-entity-risk {
  font-family: var(--mono);
  font-size: 14px;
  font-weight: 800;
}

.ap-entity-risk.high { color: var(--accent-red); }
.ap-entity-risk.medium { color: var(--accent-amber); }
.ap-entity-risk.low { color: var(--accent-green); }

.ap-entity-risk-bar {
  height: 3px;
  background: rgba(255, 255, 255, 0.06);
  border-radius: 2px;
  margin-bottom: 6px;
  overflow: hidden;
}

.ap-entity-risk-fill {
  height: 100%;
  border-radius: 2px;
  transition: width 0.6s cubic-bezier(0.22, 1, 0.36, 1);
}

.ap-entity-risk-fill.high { background: var(--accent-red); }
.ap-entity-risk-fill.medium { background: var(--accent-amber); }
.ap-entity-risk-fill.low { background: var(--accent-green); }

.ap-entity-reason { font-size: 10px; color: var(--text-secondary); }
.ap-entity-summary { font-size: 10px; color: var(--text-secondary); margin-top: 4px; opacity: 0.8; }

.ap-empty { font-size: 11px; color: var(--text-secondary); text-align: center; padding: 20px; }

/* Actions */
#agent-panel-actions {
  display: flex;
  gap: 6px;
  flex-wrap: wrap;
  padding: 12px 16px;
  border-top: 1px solid var(--border);
  flex-shrink: 0;
}

.agent-panel-btn {
  flex: 1;
  padding: 8px 12px;
  font-size: 10px;
  font-weight: 600;
  letter-spacing: 0.8px;
  text-transform: uppercase;
  border-radius: 3px;
  cursor: pointer;
  transition: all 0.15s;
  background: var(--surface-raised);
  border: 1px solid var(--border);
  color: var(--text-primary);
}

.agent-panel-btn:hover { border-color: var(--accent); color: var(--accent); }
.agent-panel-btn-secondary { color: var(--text-secondary); }

/* Error view */
#agent-panel-error {
  flex-direction: column;
  align-items: center;
  justify-content: center;
  gap: 12px;
  padding: 40px 20px;
  flex: 1;
}

.agent-panel-error-icon {
  width: 40px;
  height: 40px;
  border-radius: 50%;
  background: rgba(205, 66, 70, 0.12);
  border: 1px solid var(--accent-red);
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 18px;
  font-weight: 700;
  color: var(--accent-red);
}

#agent-panel-error-msg { font-size: 12px; color: var(--text-secondary); text-align: center; max-width: 320px; }

/* Sidebar mini indicator */
#agent-result-mini {
  padding: 6px 8px;
  background: var(--surface-raised);
  border: 1px solid var(--border);
  border-radius: 3px;
}

.agent-mini-status {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 6px;
}

#agent-mini-state {
  font-family: var(--mono);
  font-size: 10px;
  color: var(--text-secondary);
}

.agent-mini-open-btn {
  font-size: 9px;
  font-weight: 600;
  letter-spacing: 0.8px;
  text-transform: uppercase;
  padding: 3px 8px;
  border-radius: 3px;
  background: var(--accent-dim);
  border: 1px solid rgba(45, 114, 210, 0.3);
  color: var(--accent);
  cursor: pointer;
  transition: all 0.15s;
}

.agent-mini-open-btn:hover { background: rgba(45, 114, 210, 0.2); }

/* ════════════════════════════════════════════════════════════════
   EXECUTIVE DASHBOARD (Overlay)
   ════════════════════════════════════════════════════════════════ */

#dashboard-overlay {
  position: fixed;
  inset: 0;
  z-index: 60;
  pointer-events: none;
  display: none;
}

#dashboard-overlay.open {
  display: flex;
  justify-content: flex-end;
  align-items: stretch;
  padding: calc(var(--nav-h) + 10px) 10px calc(var(--footer-h) + 10px);
}

#dash-panel {
  width: min(900px, 62vw);
  height: 100%;
  overflow-y: auto;
  padding: 16px;
  border-radius: 3px;
  border: 1px solid var(--border);
  background: var(--surface);
  pointer-events: auto;
  scrollbar-width: thin;
}

#dash-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 14px;
}

#dash-header h2 {
  font-size: 12px;
  font-weight: 600;
  letter-spacing: 1.5px;
  text-transform: uppercase;
  color: var(--text-heading);
}

#dash-close {
  background: none;
  border: none;
  color: var(--text-secondary);
  font-size: 22px;
  cursor: pointer;
}

#dash-close:hover { color: var(--text-primary); }

.dash-kpis {
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  gap: 8px;
  margin-bottom: 14px;
}

.dash-kpi {
  background: var(--surface-raised);
  border: 1px solid var(--border);
  border-radius: 3px;
  padding: 12px;
  text-align: center;
}

.dash-kpi-value {
  font-size: 26px;
  font-weight: 800;
  font-family: var(--mono);
  margin-bottom: 2px;
}

.dash-kpi-label {
  font-size: 10px;
  font-weight: 600;
  color: var(--text-secondary);
  text-transform: uppercase;
  letter-spacing: 1px;
  margin-bottom: 2px;
}

.dash-kpi-sub { font-size: 9px; color: var(--text-secondary); }

.dash-tooltip-target {
  position: relative;
  cursor: help;
  text-decoration: underline dotted rgba(255,255,255,0.15);
  text-underline-offset: 2px;
}

.dash-tooltip-target::after {
  content: attr(data-tooltip);
  position: absolute;
  left: 50%;
  bottom: calc(100% + 6px);
  transform: translate(-50%, 4px);
  min-width: 160px; max-width: 240px;
  width: max-content;
  padding: 6px 8px;
  border-radius: 4px;
  border: 1px solid var(--border-active);
  background: var(--base);
  color: var(--text-primary);
  font-size: 10px;
  font-weight: 400;
  line-height: 1.4;
  letter-spacing: normal;
  white-space: normal;
  text-transform: none;
  text-align: left;
  pointer-events: none;
  opacity: 0;
  transition: opacity 0.15s, transform 0.15s;
  z-index: 8;
}

.dash-tooltip-target:hover::after,
.dash-tooltip-target:focus-visible::after {
  opacity: 1;
  transform: translate(-50%, 0);
}

.dash-charts {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 8px;
  margin-bottom: 10px;
}

.dash-charts .dash-chart-panel { grid-column: 1 / -1; }

.dash-chart-panel {
  background: var(--surface-raised);
  border: 1px solid var(--border);
  border-radius: 3px;
  padding: 12px;
}

.dash-chart-panel h3 {
  font-size: 10px;
  font-weight: 600;
  color: var(--text-secondary);
  text-transform: uppercase;
  letter-spacing: 1.5px;
  margin-bottom: 10px;
}

.dash-chart-panel canvas { width: 100%; height: auto; }

.dash-heatmap { display: grid; grid-template-columns: repeat(4, 1fr); gap: 6px; }

.dash-heatmap-cell {
  border-radius: 3px;
  padding: 10px 8px;
  text-align: center;
  border: 1px solid var(--border);
  background: var(--surface) !important;
}

.dash-hm-label { font-size: 9px; font-weight: 600; color: var(--text-secondary); letter-spacing: 1px; margin-bottom: 3px; }
.dash-hm-risk { font-size: 20px; font-weight: 800; font-family: var(--mono); color: var(--text-heading); }
.dash-heatmap-cell.high-risk .dash-hm-risk { color: var(--accent-red); }
.dash-hm-count { font-size: 9px; color: var(--text-secondary); }
.dash-hm-alert { font-size: 8px; color: var(--accent-red); font-weight: 700; margin-top: 2px; }

.dash-summary-section {
  background: var(--surface-raised);
  border: 1px solid var(--border);
  border-radius: 3px;
  padding: 12px;
}

.dash-summary-section h3 {
  font-size: 10px;
  font-weight: 600;
  color: var(--text-secondary);
  text-transform: uppercase;
  letter-spacing: 1.5px;
  margin-bottom: 8px;
}

.dash-summary { font-size: 12px; line-height: 1.5; color: var(--text-primary); }
.dash-loading { text-align: center; color: var(--text-secondary); font-size: 12px; padding: 30px 0; }
.dash-error { text-align: center; color: var(--accent-red); font-size: 12px; padding: 30px 0; }

#dashboard-btn {
  /* In sidebar now — styled via sb-action-btn */
}

/* ════════════════════════════════════════════════════════════════
   STATUS BAR (Footer)
   ════════════════════════════════════════════════════════════════ */

#status-bar {
  grid-area: footer;
  display: flex;
  align-items: center;
  gap: 0;
  padding: 0 14px;
  background: #0a0e13;
  border-top: 1px solid var(--border);
  font-family: var(--mono);
  font-size: 10px;
  color: var(--text-secondary);
  z-index: 50;
  font-variant-numeric: tabular-nums;
}

.status-live {
  color: var(--accent-green);
  animation: status-pulse 2s ease-in-out infinite;
}

@keyframes status-pulse {
  0%, 100% { opacity: 1; }
  50% { opacity: 0.5; }
}

.status-sep {
  margin: 0 8px;
  color: rgba(255, 255, 255, 0.1);
}

.status-right {
  margin-left: auto;
}

#connection-status { color: var(--accent-green); }

/* Hide old stats overlay — replaced by status bar */
#stats-overlay { display: none !important; }
/* Hide old action bar — buttons moved to sidebar */
#action-bar { display: none !important; }

/* ════════════════════════════════════════════════════════════════
   COUNTERFACTUAL
   ════════════════════════════════════════════════════════════════ */

#cf-result { margin-top: 10px; }

.cf-delta-card {
  background: var(--surface-raised);
  border: 1px solid var(--border);
  border-radius: 3px;
  padding: 10px;
}

.cf-delta-row { display: flex; align-items: center; gap: 10px; margin-bottom: 8px; }
.cf-score { text-align: center; }
.cf-score-value { font-size: 22px; font-family: var(--mono); font-weight: 800; display: block; }
.cf-score-label { font-size: 9px; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.5px; }
.cf-arrow { font-size: 18px; color: var(--text-secondary); }
.cf-delta-badge { font-family: var(--mono); font-size: 14px; font-weight: 700; margin-left: auto; }

.cf-removed-info { font-size: 10px; color: var(--text-secondary); margin-bottom: 6px; }

.cf-reason-tag {
  display: inline-block;
  padding: 1px 5px;
  border-radius: 3px;
  font-size: 9px;
  background: var(--base);
  border: 1px solid var(--border);
  color: var(--text-primary);
  margin: 0 2px;
}

.cf-summary { margin-bottom: 8px; }

.cf-edge-list { margin-top: 8px; }
.cf-edge-list h4 { font-size: 10px; color: var(--text-secondary); margin-bottom: 4px; text-transform: uppercase; letter-spacing: 0.5px; }

.cf-edge-row {
  display: flex;
  align-items: center;
  gap: 4px;
  padding: 3px 0;
  font-size: 10px;
  border-bottom: 1px solid var(--border);
}

.cf-entity-link {
  background: none;
  border: none;
  color: var(--accent);
  font-family: var(--mono);
  font-size: 10px;
  cursor: pointer;
  text-decoration: underline;
  padding: 0;
}

.cf-entity-link:hover { color: var(--text-heading); }
.cf-edge-arrow { color: var(--text-secondary); }
.cf-edge-meta { color: var(--text-secondary); margin-left: auto; font-family: var(--mono); }
.cf-error { color: var(--accent-red); font-size: 11px; padding: 10px 0; }

/* ════════════════════════════════════════════════════════════════
   WIZARD (Full-screen modal)
   ════════════════════════════════════════════════════════════════ */

.wizard-backdrop {
  position: fixed;
  inset: 0;
  background: rgba(10, 14, 19, 0.95);
  transition: background 0.8s ease;
  z-index: 200;
}

.wizard-backdrop::before,
.wizard-backdrop::after { display: none; } /* No scanlines/glow */

.wizard-backdrop.hidden { display: none; }
.wizard-backdrop.step-0 { background: rgba(10, 14, 19, 0.92); }
.wizard-backdrop.step-1 { background: rgba(10, 14, 19, 0.72); }
.wizard-backdrop.step-2 { background: rgba(10, 14, 19, 0.50); }
.wizard-backdrop.step-3 { background: rgba(10, 14, 19, 0.28); }
.wizard-backdrop.step-4 { background: rgba(10, 14, 19, 0.12); }
.wizard-backdrop.reveal  { background: rgba(10, 14, 19, 0.0); pointer-events: none; }

.wizard-card {
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  background: var(--surface);
  border: 1px solid var(--border-active);
  border-radius: 3px;
  padding: 40px 44px;
  max-width: 440px;
  width: 90%;
  z-index: 201;
  text-align: center;
  transition: all 0.5s ease;
}

.wizard-card.hidden { display: none; }

.wizard-card.sequencing {
  top: auto;
  bottom: 12%;
  transform: translateX(-50%);
  max-width: 360px;
  padding: 24px 32px;
  background: rgba(15, 18, 24, 0.92);
}

.wizard-card.reveal {
  opacity: 0;
  transform: translate(-50%, 20px) scale(0.97);
  pointer-events: none;
}

.wizard-brand {
  font-family: var(--mono);
  font-size: 28px;
  font-weight: 800;
  letter-spacing: 6px;
  color: var(--accent);
  margin-bottom: 8px;
}

.wizard-brand.small {
  font-size: 13px;
  letter-spacing: 3px;
  margin-bottom: 10px;
  opacity: 0.5;
}

.wizard-subtitle {
  font-size: 10px;
  color: var(--text-secondary);
  letter-spacing: 1.5px;
  text-transform: uppercase;
  margin-bottom: 28px;
}

/* Dropzone */
.wizard-dropzone {
  border: 2px dashed var(--border-active);
  border-radius: 3px;
  padding: 32px 20px;
  cursor: pointer;
  transition: all 0.2s;
  background: var(--base);
}

.wizard-dropzone:hover,
.wizard-dropzone.dragover {
  border-color: var(--accent);
  background: rgba(45, 114, 210, 0.06);
}

.dropzone-icon {
  font-family: var(--mono);
  font-size: 24px;
  font-weight: 800;
  color: var(--accent);
  margin-bottom: 10px;
  letter-spacing: 3px;
}

.wizard-dropzone p {
  font-size: 12px;
  color: var(--text-secondary);
  line-height: 1.6;
}

.wizard-error {
  display: none;
  color: var(--accent-red);
  font-size: 11px;
  margin-top: 10px;
}

.wizard-divider {
  display: flex;
  align-items: center;
  gap: 10px;
  margin: 20px 0;
  color: var(--text-secondary);
  font-size: 10px;
  letter-spacing: 1px;
  text-transform: uppercase;
}

.wizard-divider::before,
.wizard-divider::after {
  content: "";
  flex: 1;
  height: 1px;
  background: var(--border);
}

.wizard-btn {
  background: var(--accent);
  border: none;
  color: var(--base);
  font-size: 12px;
  font-weight: 700;
  letter-spacing: 1px;
  padding: 11px 20px;
  border-radius: 3px;
  cursor: pointer;
  transition: all 0.15s;
  width: 100%;
}

.wizard-btn:hover:not(:disabled) {
  filter: brightness(1.15);
}

.wizard-btn:disabled {
  opacity: 0.4;
  cursor: not-allowed;
}

.wizard-btn.secondary {
  background: var(--surface-raised);
  border: 1px solid var(--border);
  color: var(--text-secondary);
}

.wizard-btn.secondary:hover { border-color: var(--border-active); color: var(--text-primary); }

/* Schema mapping */
.mapping-title {
  font-family: var(--mono);
  font-size: 15px;
  font-weight: 700;
  letter-spacing: 2px;
  color: var(--accent);
  margin-bottom: 4px;
}

.mapping-subtitle { font-size: 11px; color: var(--text-secondary); margin-bottom: 14px; }

.mapping-fields {
  display: flex;
  flex-direction: column;
  gap: 6px;
  max-height: 240px;
  overflow-y: auto;
  padding-right: 4px;
}

.mapping-row { display: flex; align-items: center; gap: 10px; }

.mapping-label {
  font-size: 11px;
  font-weight: 500;
  color: var(--text-secondary);
  min-width: 70px;
  text-align: right;
}

.mapping-label.req::after { content: " *"; color: var(--accent-red); }

.mapping-select {
  flex: 1;
  background: var(--base);
  border: 1px solid var(--border);
  border-radius: 4px;
  color: var(--text-primary);
  font-size: 11px;
  padding: 5px 8px;
  cursor: pointer;
  appearance: none;
  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='10' height='6'%3E%3Cpath d='M0 0l5 6 5-6z' fill='%236e7681'/%3E%3C/svg%3E");
  background-repeat: no-repeat;
  background-position: right 6px center;
}

.mapping-select:focus { outline: none; border-color: var(--accent); }
.mapping-select.matched { border-color: var(--accent-green); }

.mapping-divider {
  display: flex;
  align-items: center;
  gap: 8px;
  margin: 4px 0;
  color: var(--text-secondary);
  font-size: 9px;
  text-transform: uppercase;
  letter-spacing: 2px;
}

.mapping-divider::before,
.mapping-divider::after {
  content: "";
  flex: 1;
  height: 1px;
  background: var(--border);
}

.mapping-preview {
  margin-top: 10px;
  max-height: 90px;
  overflow: auto;
  font-size: 9px;
  color: var(--text-secondary);
  border: 1px solid var(--border);
  border-radius: 4px;
  padding: 4px;
  display: none;
}

.mapping-preview table { width: 100%; border-collapse: collapse; }
.mapping-preview th { font-weight: 600; color: var(--text-primary); text-align: left; padding: 2px 4px; border-bottom: 1px solid var(--border); }
.mapping-preview td { padding: 2px 4px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 100px; }

.mapping-actions { display: flex; gap: 6px; margin-top: 14px; }
.mapping-actions .wizard-btn { width: auto; flex: 1; }

/* Boot sequence */
.seq-phase {
  font-family: var(--mono);
  font-size: 16px;
  font-weight: 800;
  letter-spacing: 4px;
  color: var(--accent);
  margin-bottom: 6px;
  text-transform: uppercase;
}

.seq-phase.ready {
  color: var(--accent-green);
}

.seq-subtitle {
  font-family: var(--mono);
  font-size: 11px;
  color: var(--text-secondary);
  margin-bottom: 14px;
}

.seq-progress-track {
  height: 3px;
  background: rgba(45, 114, 210, 0.12);
  border-radius: 2px;
  overflow: hidden;
}

.seq-progress-bar {
  height: 100%;
  width: 0%;
  background: var(--accent);
  border-radius: 2px;
  transition: width 0.3s ease;
}

.seq-counter {
  font-family: var(--mono);
  font-size: 32px;
  font-weight: 800;
  color: var(--text-heading);
  margin: 12px 0 6px;
  min-height: 40px;
}

.seq-steps {
  display: flex;
  justify-content: center;
  gap: 6px;
  margin-top: 10px;
}

.seq-dot {
  width: 5px;
  height: 5px;
  border-radius: 50%;
  background: rgba(45, 114, 210, 0.2);
  transition: all 0.3s;
}

.seq-dot.active { background: var(--accent); }
.seq-dot.done { background: var(--accent-green); }

/* Ready stats */
.ready-stats {
  display: flex;
  justify-content: center;
  gap: 28px;
  margin: 16px 0;
}

.ready-stat { display: flex; flex-direction: column; align-items: center; }

.ready-value {
  font-family: var(--mono);
  font-size: 26px;
  font-weight: 800;
  color: var(--text-heading);
}

.ready-stat label {
  font-size: 9px;
  color: var(--text-secondary);
  letter-spacing: 1px;
  text-transform: uppercase;
  margin-top: 2px;
}

/* ════════════════════════════════════════════════════════════════
   RESPONSIVE
   ════════════════════════════════════════════════════════════════ */

@media (max-width: 1200px) {
  #dash-panel { width: min(820px, 72vw); }
  .dash-kpis { grid-template-columns: repeat(2, 1fr); }
}

@media (max-width: 900px) {
  #dashboard-overlay.open { padding: 60px 8px 36px; }
  #dash-panel { width: 100%; padding: 12px; }
  .dash-charts { grid-template-columns: 1fr; }
}
